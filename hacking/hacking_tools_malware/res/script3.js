const right_arrow_heavy = '&#9654;';
const left_arrow_heavy = '&#9664;';

function changeFrame(file_path) {
    const iframe = document.getElementById("page_frame");
    iframe.src = file_path;
}

function toggleSubTree(element) {
    const nextSibling = element.parentElement.nextElementSibling;
    if (nextSibling.tagName === 'UL') {
        nextSibling.classList.toggle('hide');
        element.textContent = element.textContent === '+' ? '-' : '+';
    }
}

function expandAllSubtrees() {
    document.querySelectorAll(".subtree").forEach(subtree => {
        subtree.classList.remove('hide');
        subtree.previousElementSibling.firstChild.textContent = '-';
    });
}

function collapseAllSubtrees() {
    document.querySelectorAll(".subtree").forEach(subtree => {
        subtree.classList.add('hide');
        subtree.previousElementSibling.firstChild.textContent = '+';
    });
}

function toggle_tree_panel() {
    const tree = document.querySelector('.tree-panel');
    const toggle_btn = document.getElementById('tree_panel_toggle_btn');
    const pagePanel = document.querySelector('.page-panel');

    if (tree.style.display === 'none') {
        tree.style.display = 'block';
        toggle_btn.innerHTML = left_arrow_heavy;
        toggle_btn.style.left = '300px';
        pagePanel.style.marginLeft = '0';
    } else {
        tree.style.display = 'none';
        toggle_btn.innerHTML = right_arrow_heavy;
        toggle_btn.style.left = '0';
        pagePanel.style.marginLeft = '0';
    }
}

function handle_keypress(ev) {
    if (ev.key === "Escape") {
        toggle_tree_panel();
    }
}

window.onload = function() {
    const show_page = window.location.hash.substr(1);
    if (show_page !== '') {
        changeFrame(show_page);
    }

    document.onkeydown = handle_keypress;

    const panels = document.querySelector(".two-panels");
    const toggle_btn = document.createElement("button");
    toggle_btn.onclick = toggle_tree_panel;
    toggle_btn.innerHTML = left_arrow_heavy;
    toggle_btn.id = 'tree_panel_toggle_btn';
    panels.appendChild(toggle_btn);
};