<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Recopilación de información</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Recopilación de información</h1><br/><p><strong><h1>TIPOS DE AUDITORIAS DE SEGURIDAD</h1></strong></p><p></p><p><h2>Auditoria externa:</h2></p><p>No se dispone de acceso lógico o físico a la infraestructura de red de la organización</p><p></p><p><h2>Auditoria interna :</h2></p><p>Se dispone de acceso lógico (o VPN) o físico (infraestructura) a la red de la organización con los siguientes factores:<ul><li>Sin credenciales de usuario de dominio; usamos nuestro ordenador personal dentro de la red pero no disponemos de credenciales de ningún tipo </li><li>Con credenciales de usuario de dominio; ya sean un usuario dentro del dominio que usemos en nuestra máquina o un ordenador de la organización ya dentro de la infraestructura.</li></ul></p><p></p><p>Lo más normal en una auditoria de Active Directory es estándar que estemos en la infraestructura interna de la organización y tengamos un usuario sin privilegios perteneciente al dominio.</p><p></p><p></p><p><h1>¿QUE INFORMACIÓN RECOPILAR?</h1></p><p></p><p>El objetivo de vulnerar una infraestructura se basa en conseguir un usuario con privilegios de administrador del domino.</p><p>Para esto vamos a realizar un análisis de información para recopilar datos últiles sobre la estructura del dominio, grupos, usuarios, etc</p><p><ul><li>Usuarios y cuentas locales</li><li>Grupos locales</li><li>Usuarios y cuentas de dominio</li><li>Equipos de dominio </li><li>Grupos de dominio</li><li>OUs o unidades organizativas</li><li>GPOs o políticas </li><li>ACLs</li><li>Relaciones de confianza entre forests y domains</li><li>Atributos de los objetos</li><li>...</li></ul></p><p></p><p><h1>RECOPILACIÓN DE INFORMACIÓN LOCAL</h1></p><p></p><p>Recopilación de información dentro de la máquina dentro de la red de dominio.</p><p>Lo más interesante es recopilar datos sobre los usuarios y grupos. Para ello se suele recurrir a una base de datos local que administra los usuarios a nivel local dentro de la maquina windows llamada SAM (security account manager).</p><p>Esta base de datos se comprueba por LSA (Local security autority) para autenticar el acceso de los usuarios al sistema local.</p><p></p><p>Las contraseñas de los usuarios se almacenan hasheadas en el registro de windows (HKLM/SAM) en la ruta %SystemRoot%/system32/config/SAM</p><p></p><p>La SAM puede enumerar de forma local y remotamente aunque a tener en cuenta a partir de windows 10 1607 y windows server 2016 es necesario que el usuario tenga privilegios de administrador para ello aunque en versiones anterior un USUARIO DE DOMINIO si podía enumerar la SAM.</p><p></p><p><h1>RECOPILACIÓN DE INFORMACIÓN REMOTA</h1></p><p></p><p>Es la enumeración de la información de ese archivo o base de datos que se crea en el servidor creado como DC o domain controller, en la que se encuentran todos los datos y configuraciones del dominio, políticas, grupos, usuarios, relaciones, etc.</p><p>Para esto existen las interfaces que se comunican con este DataControler siendo la más importante para nosotros la LDAP (Lightweight Directory Access Portal) ya que es un protocolo de aplicación que permite interactuar con servicios de directorio para almacenar, leer o modificar información.</p><p></p><p>Lo interesante de este protocolo es que puede ser utilizado por cualquier usuario independientemente de sus privilegios, (obviamente si se es usuario basico no se podrán modificar los datos pero si consultarlos) y esto supone que con cualquier usuario de dominio podamos consultar la estructura interna del dominio y así ganar información sobre qué usuarios, grupos, unidades organizativas, etc son las más importantes o vulnerables a escalado de privilegio así como sus relaciones.</p><p></p><p>Como dato curioso es que este protocolo no puede ser desactivado y si así fuese sería un problema a la hora de crear usuarios o que los usuarios utilizasen servicios dentro del dominio ya que cualquier usuario debe conocer sus relaciones y su posición para poder acatar las políticas y restricciones asignadas a si mismo, grupos pertenecientes o aplicaciones a las que tenga acceso, por lo que es una buena herramienta desde el punto de vista de recaudación de información para una auditoría.</p></div>
</body>
</html>
