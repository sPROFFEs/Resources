<!doctype html>
<html>

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Script para desofuscar</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>

<body>
  <div class='page'>
    <h1 class='title'>Script para desofuscar</h1><br />
    <p></p>
    <p>
    <h3>A continuación se adjunta un script para desofuscar el código anterior de hexadecimal y además vamos a añadir
      una función para descomprimir el código que vemos tan largo en la web.</h3>
    </p>
    <p></p>
    <p>
    <div class="codebox">
      <pre><br /><span style="color:#ad7fa8;font-weight:400">import</span> re<br /><span style="color:#ad7fa8;font-weight:400">import</span> zlib<br /><br /><span style="color:#888a85;font-weight:400"># El código ofuscado original</span><br />obfuscated_code = <span style="color:#edd400;font-weight:400">&quot;&quot;&quot;<br />from builtins import *<br />XWWWWWWWWWXWWWXWXXW, jiliiliiijjlllllll, XWWXWXXXXWWWXXWWWXWXXXXXX, mnnnnnnnmnmmmmnmnnmmm, MMNMNNMMMMNNMNMMM = (<br />    (lambda IIIllllIlIllIIIIl: IIIllllIlIllIIIIl(__import__(&#39;\x7a\x6c\x69\x62&#39;))),<br />    (lambda IIIllllIlIllIIIIl: globals()[&#39;\x65\x76\x61\x6c&#39;](<br />        globals()[&#39;\x63\x6f\x6d\x70\x69\x6c\x65&#39;](<br />            globals()[&#39;\x73\x74\x72&#39;](&quot;\x67\x6c\x6f\x62\x61\x6c\x73\x28\x29\x5b\x27\x5c\x78\x36\x35\x5c\x78\x37\x36\x5c\x78\x36\x31\x5c\x78\x36\x63\x27\x5d(IIIllllIlIllIIIIl)&quot;),<br />            filename=&#39;\x53\x32\x53\x53\x53\x53\x53\x53\x32\x53\x53\x53\x32\x32\x32\x53\x32\x53\x53&#39;,<br />            mode=&#39;\x65\x76\x61\x6c&#39;))),<br />    (lambda IIIllllIlIllIIIIl: IIIllllIlIllIIIIl[&#39;\x64\x65\x63\x6f\x6d\x70\x72\x65\x73\x73&#39;]),<br />    (lambda mnmnmmmnmnnmnnnnm, IIIllllIlIllIIIIl: mnmnmmmnmnnmnnnnm(IIIllllIlIllIIIIl)),<br />    (lambda: (lambda IIIllllIlIllIIIIl: globals()[&#39;\x65\x76\x61\x6c&#39;](<br />        globals()[&#39;\x63\x6f\x6d\x70\x69\x6c\x65&#39;](<br />            globals()[&#39;\x73\x74\x72&#39;](&quot;\x67\x6c\x6f\x62\x61\x6c\x73\x28\x29\x5b\x27\x5c\x78\x36\x35\x5c\x78\x37\x36\x5c\x78\x36\x31\x5c\x78\x36\x63\x27\x5d(IIIllllIlIllIIIIl)&quot;),<br />            filename=&#39;\x53\x32\x53\x53\x53\x53\x53\x53\x32\x53\x53\x53\x32\x32\x32\x53\x32\x53\x53&#39;,<br />            mode=&#39;\x65\x76\x61\x6c&#39;))))(&#39;\x5f\x5f\x69\x6d\x70\x6f\x72\x74\x5f\x5f\x28\x27\x62\x75\x69\x6c\x74\x69\x6e\x73\x27\x29\x2e\x65\x78\x65\x63&#39;))<br />)<br /><br />MMNMNNMMMMNNMNMMM()(mnnnnnnnmnmmmmnmnnmmm(XWWXWXXXXWWWXXWWWXWXXXXXX(XWWWWWWWWWXWWWXWXXW(jiliiliiijjlllllll(&#39;\x76\x61\x72\x73&#39;))))<br />&quot;&quot;&quot;</span><br /><br /><span style="color:#888a85;font-weight:400"># Función para desofuscar secuencias hexadecimales</span><br /><span style="color:#000000;font-weight:700">def</span> <span style="color:#729fcf;font-weight:400">desofuscar_hexadecimales</span>(codigo):<br />    <span style="color:#888a85;font-weight:400"># Encuentra todas las secuencias \x en el código y las reemplaza por sus caracteres correspondientes</span><br />    <span style="color:#000000;font-weight:700">def</span> <span style="color:#729fcf;font-weight:400">convertir_hexadecimal</span>(match):<br />        <span style="color:#000000;font-weight:700">return</span> <span style="color:#729fcf;font-weight:400">bytes</span>.fromhex(match.group(<span style="color:#edd400;font-weight:400">0</span>).replace(<span style="color:#edd400;font-weight:400">&quot;\\x&quot;</span>, <span style="color:#edd400;font-weight:400">&quot;&quot;</span>)).decode(<span style="color:#edd400;font-weight:400">&quot;utf-8&quot;</span>)<br />    <br />    <span style="color:#888a85;font-weight:400"># Reemplaza todas las ocurrencias de \x.. en el código</span><br />    codigo_legible = re.sub(<span style="color:#edd400;font-weight:400">r&#39;\\x[0-9a-fA-F]{2}&#39;</span>, convertir_hexadecimal, codigo)<br />    <span style="color:#000000;font-weight:700">return</span> codigo_legible<br /><br /><span style="color:#888a85;font-weight:400"># Función para descomprimir y mostrar datos de forma segura</span><br /><span style="color:#000000;font-weight:700">def</span> <span style="color:#729fcf;font-weight:400">descomprimir_datos</span>(compressed_data):<br />    <span style="color:#000000;font-weight:700">try</span>:<br />        <span style="color:#888a85;font-weight:400"># Descomprimir los datos utilizando zlib</span><br />        descomprimido = zlib.decompress(compressed_data)<br />        <span style="color:#000000;font-weight:700">return</span> descomprimido.decode(<span style="color:#edd400;font-weight:400">&#39;utf-8&#39;</span>)<br />    <span style="color:#000000;font-weight:700">except</span> <span style="color:#8ae234;font-weight:700">Exception</span> <span style="color:#ad7fa8;font-weight:400">as</span> e:<br />        <span style="color:#000000;font-weight:700">return</span> f<span style="color:#edd400;font-weight:400">&quot;Error descomprimiendo los datos: {e}&quot;</span><br /><br /><span style="color:#888a85;font-weight:400"># Datos comprimidos</span><br />compressed_data = <span style="color:#edd400;font-weight:400">b&#39;x\x9c\xed...</span><br /><br /><span style="color:#888a85;font-weight:400"># Descomprimir y mostrar los datos</span><br />datos_descomprimidos = descomprimir_datos(compressed_data)<br /><br /><span style="color:#888a85;font-weight:400"># Mostrar el código desofuscado</span><br />codigo_desofuscado = desofuscar_hexadecimales(obfuscated_code)<br /><br /><span style="color:#729fcf;font-weight:400">print</span>(<span style="color:#edd400;font-weight:400">&quot;Código desofuscado:\n&quot;</span>)<br /><span style="color:#729fcf;font-weight:400">print</span>(codigo_desofuscado)<br /><span style="color:#729fcf;font-weight:400">print</span>(<span style="color:#edd400;font-weight:400">&quot;\nDatos descomprimidos:\n&quot;</span>)<br /><span style="color:#729fcf;font-weight:400">print</span>(datos_descomprimidos)<br /></pre>
    </div>
    </p>
    <p></p>
    <p>
    <h3>Lo más interesante de aquí puede ser como tratar los hexadecimales para decodificarlos.</h3>
    </p>
    <p></p>
    <div class="codebox">
      <pre><br /><span>def desofuscar_hexadecimales(codigo):</span></pre>
    </div>
    <h3>Se define la función que toma un argumento llamado codigo, que es una cadena de texto que puede contener
      caracteres en formato hexadecimal.</h3>
    </p>
    <p></p>
    <p>
    <h3>Se define una función interna llamada convertir_hexadecimal que se utiliza para convertir cada coincidencia
      encontrada de la expresión regular.</h3>
    </p>
    <p>
    <div class="codebox">
      <pre><br /><span>   def convertir_hexadecimal(match):match</span></pre>
    </div>
    <h3> es un objeto que representa la coincidencia encontrada por la expresión regular.</h3>
    </p>
    <p></p>
    <p>
    <h3>Dentro de convertir_hexadecimal se utiliza match.group(0) para obtener la coincidencia completa (la cadena que
      coincide con el patrón).</h3>
    </p>
    <p></p>
    <div class="codebox">
      <pre><br /><span>replace(&quot;\\x&quot;, &quot;&quot;)</span></pre>
    </div>
    <h3> elimina el prefijo \x de la cadena, dejando solo los dos caracteres hexadecimales.</h3>
    </p>
    <p></p>
    <div class="codebox">
      <pre><br /><span>bytes.fromhex(...)</span></pre>
    </div>
    <h3> convierte la cadena de caracteres hexadecimales en una representación de bytes.</h3>
    </p>
    <p></p>
    <div class="codebox">
      <pre><br /><span>decode(&quot;utf-8&quot;)</span></pre>
    </div>
    <h3> convierte esos bytes a una cadena de texto usando la codificación UTF-8.</h3>
    </p>
    <p></p>
    <p>
    <div class="codebox">
      <pre><br />re.sub(<span style="color:#edd400;font-weight:400">r&#39;\\x[0-9a-fA-F]{2}&#39;</span>, convertir_hexadecimal, codigo)</pre>
    </div>
    </p>
    <p></p>
    <p>
    <h3>Esta línea usa la función re.sub de la biblioteca re</h3>
    <h3> (expresiones regulares) para buscar todas las secuencias que coinciden con el patrón </h3>
    <h3>\\x[0-9a-fA-F]{2}</h3>
    <h3> en la cadena codigo</h3>
    <p></p>
    <p>
    <h3>El patrón busca cualquier secuencia que comience con \x seguido de exactamente dos dígitos hexadecimales (del 0
      al 9 y de A a F, tanto mayúsculas como minúsculas)</h3>
    </p>
    <p></p>
    <p>
    <h3>Por cada coincidencia encontrada, llama a la función convertir_hexadecimal, que convierte la representación
      hexadecimal en el carácter correspondiente.</h3>
    </p>
    <p></p>
    <p>
    <table style="display:inline-table">
      <tr>
        <td><a href="EmbeddedFiles/6-decodificador.py">Linked file: decodificador.py </a></td>
      </tr>
    </table>
    </p>
  </div>
</body>

</html>