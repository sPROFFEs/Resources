<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>WAF Detector</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>WAF Detector</h1><br/><p><em><strong><h1>IDENTIFICANDO WAFs</h1></strong></em></p><p></p><p>Es posiblemente la que más nos vamos a encontrar de forma estándar.</p><p></p><p>Se trata de un WAF, que consiste en un Web Aplication Firewall que apantallan la aplicación web y filtrarán peticiones buscando y evitando payloads para prevenir estas explotaciones.</p><p></p><p>Buscan patrones SQLInjection, crossite scripting, etc...</p><p></p><p>Para saber como evadirlos debemos saber primero que tipo de WAF tiene la aplicación por delante con la herramienta Wafw00f:</p><p></p><p><a href="https://github.com/EnableSecurity/wafw00f">https://github.com/EnableSecurity/wafw00f</a></p><p></p><p>Es una herramienta muy popular que implementa las firmas para muchos proveedores.</p><p>Por defecto viene en Kali:</p><p><img src="images/60-1.png" alt="images/60-1.png" /></p><p></p><p>Esta herramienta funciona de la siguiente forma:</p><p></p><p>Podemos habilitar uno para pruebas en AWS&gt;</p><p></p><p><img src="images/60-2.png" alt="images/60-2.png" /></p><p></p><p>Para detectar qué tecnología está usando el WAF:</p><p></p><p><div class="codebox"><pre><br />wafw00f URL del dominio</pre></div></p><p></p><p><img src="images/60-3.png" alt="images/60-3.png" /></p><p></p><p>Como se indica aquí el servicio se encuentra detrás de un WAF y te indica que versión y qué tecnología está usando.</p><p></p><p>Esto es importante por que la evasión de los WAF van dirigidas en función de la tecnología que estén utilizando.</p><p>Lo bueno de esta herramienta es que es muy poco intrusiva.</p><p></p><p>En producción normalmente todas las empresas que ofrecen su aplicación web que tengan medianamente buenos recursos van a estar apantalladas por un WAF en sus aplicaciones principales.</p><p></p><p>Por supuesto estas aplicaciones WAF filtrarán cualquier tipo de análisis de vulnerabilidades que hagamos en la aplicación web</p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p><em><strong><h1>EVADIENDO WAFs</h1></strong></em></p><p></p><p>No es una tarea nada sencilla,  lo más óptimo sería intentar buscar otros subdominios en los que potencialmente no haya estas aplicaciones apantallando.</p><p>Esto es común porque cuando se contrata un proveedor de WAF este te cobra en función de a los subdominios o dominios que quieras aplicarlo y obviamente este suelen aplicarlo a los que se usan de forma pública, más se ven y más tráfico tienen.</p><p></p><p>Ahora bien para poder hacer un Bypass del WAF podemos optar varías alternativas:</p><p><ul><li>→ <h2>→ Indentificar la Ip del web server que a la que apunta el WAF al igual que hicimos con el balanceador.</h2></li></ul></p><p>De igual forma que hacíamos con el balanceador sería encontrar la dirección IP pública del servidor Web.</p><p></p><p>Para esto hay una herramienta concreta.</p><p></p><p><a href="https://github.com/vincentcox/bypass-firewalls-by-DNS-history">https://github.com/vincentcox/bypass-firewalls-by-DNS-history</a></p><p></p><p>Utiliza los records de histórico de DNS y trata de identificar si hay una dirección Ip asignada al dominio indicado ya que es posible que en algún momento el dominio no tuviese un WAF por lo que en servidores DNS tendría asociado su servidor web directamente al dominio y posteriormente se añadió el WAF.</p><p></p><p>Necesita un repositorio adicional:</p><p></p><p><div class="codebox"><pre><br /><span style="color:#000000;font-weight:700">sudo</span> apt <span style="color:#000000;font-weight:700">install</span> jq</pre></div></p><p></p><p><img src="images/60-4.png" alt="images/60-4.png" /></p><p></p><p>El script también obtiene las direcciones IP de los subdominios ya que en algunas ocasionas esas Ip que no están protegidas apuntan también al mismo servidor web.</p><p></p><p></p><p></p><p><ul><li><h2>Evadir su motor de reglas:</h2></li></ul></p><p></p><p>Debido a que un firewall se trata de una tecnología que parsea mediante heurísticas y patrones los paquetes del tráfico pues trata de encontrarlos y bloquearlos.</p><p></p><p>Por lo tanto algo que se puede intentar es codificar los caracteres, insertar el código Javascript o HTML que no cumpla los estándares, etc</p><p></p><p>Es algo complejo y hay que estar siempre actualizados ya que es algo que va siendo parcheado continuamente.</p><p></p><p>En este caso podemos usar algunas fuentes de información como:</p><p></p><p><a href="https://waf-bypass.com/">https://waf-bypass.com/</a></p><p></p><p>Se tratan de bypass actuales o relativamente actuales.</p><p></p><p>Otra herramienta puede ser:</p><p></p><p><a href="https://github.com/nemesida-waf/waf-bypass">https://github.com/nemesida-waf/waf-bypass</a></p><p></p><p>Se trata de una herramienta que lanza varios payloads contra el dominio y testea cuales detecta y cuales no.</p><p></p><p>Es una herramienta muy intrusiva que podría dejar fuera de servicio el WAF.</p><p></p><p><h3>Otras Herramientas:</h3></p><p></p><p><a href="https://github.com/Ekultek/WhatWaf">https://github.com/Ekultek/WhatWaf</a></p><p></p><p><a href="https://github.com/khalilbijjou/WAFNinja">https://github.com/khalilbijjou/WAFNinja</a></p><p></p><p><a href="https://github.com/wafpassproject/wafpass">https://github.com/wafpassproject/wafpass</a></p><p></p></div>
</body>
</html>
