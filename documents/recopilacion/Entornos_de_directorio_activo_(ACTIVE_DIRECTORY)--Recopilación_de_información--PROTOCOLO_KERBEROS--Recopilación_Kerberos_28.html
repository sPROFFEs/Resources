<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Recopilación Kerberos</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Recopilación Kerberos</h1><br/><p><h1>TÉCNICAS DE RECOPILACIÓN DE INFORMACIÓN CON </h1><strong><h1>KERBEROS</h1></strong></p><p></p><p>Para esto instalamos una aplicación en Kali:</p><p></p><p><a href="https://github.com/ropnop/kerbrute">https://github.com/ropnop/kerbrute</a></p><p></p><p>Es una herramienta escrita en GO que aprovecha la fase de AS-REQ para enumerar usuarios, password spraying, brute force, etc que cuando la utilizamos con Kerberos pueden ser más interesantes.</p><p></p><p>Instalamos golang:</p><p></p><p><div class="codebox"><pre><br /><span style="color:#000000;font-weight:700">sudo</span> apt <span style="color:#000000;font-weight:700">install</span> golang</pre></div></p><p></p><p>Modificamos el fichero .zshrc para indicar las variables de entorno las rutas de las aplicaciones de go:</p><p></p><p><div class="codebox"><pre><br /><span style="color:#000000;font-weight:700">sudo</span> emacs .zshrc</pre></div></p><p></p><p>y añadimos al final </p><p></p><p><div class="codebox"><pre><span style="color:#000000;font-weight:700">export</span> <span style="color:#8ae234;font-weight:700">GOROOT</span>=<span style="color:#000000;font-weight:700">/</span>usr<span style="color:#000000;font-weight:700">/</span>lib<span style="color:#000000;font-weight:700">/</span>go<br /><span style="color:#000000;font-weight:700">export</span> <span style="color:#8ae234;font-weight:700">GOPATH</span>=<span style="color:#8ae234;font-weight:700">$HOME</span><span style="color:#000000;font-weight:700">/</span>go<br /><span style="color:#000000;font-weight:700">export</span> <span style="color:#8ae234;font-weight:700">PATH</span>=<span style="color:#8ae234;font-weight:700">$GOPATH</span><span style="color:#000000;font-weight:700">/</span>bin<span style="color:#000000;font-weight:700">:</span><span style="color:#8ae234;font-weight:700">$GOROOT</span><span style="color:#000000;font-weight:700">/</span>bin<span style="color:#000000;font-weight:700">:</span><span style="color:#8ae234;font-weight:700">$PATH</span></pre></div></p><p></p><p>Todo esto para tener en las varibales de entorno tengamos esas rutas.</p><p></p><p>Recargamos configuración</p><p></p><p><div class="codebox"><pre><br /><span style="color:#000000;font-weight:700">source</span> .zshrc</pre></div></p><p></p><p>Instalamos Kerbrute:</p><p></p><p><div class="codebox"><pre><br />go <span style="color:#000000;font-weight:700">install</span> github.com<span style="color:#000000;font-weight:700">/</span>ropnop<span style="color:#000000;font-weight:700">/</span>kerbrute@latest</pre></div></p><p></p><p>Aseguramos que la maquina esté en la red virtual.</p><p></p><p></p><p>Función de enumerar usuarios del dominio sin necesidad de tener las credenciales de un usuario dentro del dominio:</p><p></p><p><div class="codebox"><pre><br />kerbrute userenum -d corp.local usernames.txt</pre></div></p><p></p><p></p><p><strong><h1>USUARIOS</h1></strong></p><p></p><p>Como toma por parámetro una lista de usuarios vamos a crear una con lo siguiente:</p><p></p><p>empleado1</p><p>empleado2</p><p>empleado2</p><p>marleen.julia</p><p>roberto</p><p>admin</p><p>admin.local</p><p>administrador</p><p></p><p>y ahora si ejecutamos:</p><p></p><p><img src="images/28-1.png" alt="images/28-1.png" /></p><p></p><p>Es muy curioso como funciona </p><p></p><p><img src="images/28-2.png" alt="images/28-2.png" /></p><p></p><p>Como vemos realiza peticiones de autenticación al AS con los nombres que le hemos proporcionado y si el servidor responde con un requerimiento de preautenticación significa que ese usuario existe. Por el contrario si recibe un error de UNKNOWN significa que ese usuario no corresponde a ninguno registrado por el AS.</p><p></p><p></p><p></p><p><strong><h1>CONTRASEÑAS</h1></strong></p><p></p><p>Para esto hay que tener en cuenta que es posible que haya políticas de bloqueo ante varios intentos de autenticación, es algo a tener en cuenta así como de que genera bastante ruido y por tanto es facilmente reconocible por IDS</p><p></p><p><div class="codebox"><pre><br />kerbrute bruteuser -d corp.local passwords.txt marleen.julia</pre></div></p><p></p><p>hay que pasar una lista de contraseñas así que creamos una con lo siguiente:</p><p></p><p>password1</p><p>Passw0rd</p><p>contraseña</p><p>Julia</p><p>12345</p><p></p><p><img src="images/28-3.png" alt="images/28-3.png" /></p><p><img src="images/28-4.png" alt="images/28-4.png" /></p><p></p><p></p><p></p><p></p><p>Otro comando interesante es:</p><p></p><p><div class="codebox"><pre><br />kerbrute bruteforce -d corp.local user_pass.txt</pre></div></p><p></p><p>La lista debe tener el formato <code>username:password</code></p><p></p><p>Otro comando interesante es:</p><p></p><p><div class="codebox"><pre><br />kerbrute passwordspray -d corp.local users.txt Passw0rd</pre></div></p><p></p><p>Esto usa una lista de usuarios y prueba en todos ellos una misma contraseña.</p><p></p><p></p><p></p><p></p><p></p><p></p><p><h3>Es muy importante tener en cuenta los eventos que generan todos estos procesos ya que son muy ruidosos, en su repositorio hay mas información.</h3></p></div>
</body>
</html>
