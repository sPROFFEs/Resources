<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Nmap</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Nmap</h1><br/><p><img src="images/3-1.png" alt="images/3-1.png" /></p><p></p><p><div class="codebox"><pre><br /><span style="color:#000000;font-weight:700">sudo</span> nmap -sS -n 192.168.20.0<span style="color:#000000;font-weight:700">/</span>24</pre></div></p><p><h3>-n → No hacer resolución DNS reversa, se utiliza para desactivar la resolución de DNS durante el escaneo. No realizará la resolución de nombres de dominio para las direcciones IP de los objetivos y mostrará las direcciones IP directamente en los resultados del escaneo en lugar de los nombres de host.</h3></p><p></p><p><h3>0/24 → Rango de ip</h3></p><p></p><p></p><p><h3>Si se realiza de esta forma se puede ser visto por los sistemas de detección como SNORT u otros IDS</h3></p><p></p><p><div class="codebox"><pre><br /> -sn <span style="color:#000000;font-weight:700">(</span>No port scan<span style="color:#000000;font-weight:700">)</span> <br /></pre></div></p><p><h3>En este caso solo detecta los host de la subred pero no activará detección en SNORT, ya que el tráfico generado es unicamente ARP (esta dirección IP a que dirección MAC corresponde)</h3></p><p><h3>No es muy confiable ya que es muy fácil de spoofear el protocolo ARP </h3></p><p></p><p><div class="codebox"><pre> <br /> -PS &lt;port list&gt; <span style="color:#000000;font-weight:700">(</span>TCP SYN Ping<span style="color:#000000;font-weight:700">)</span> </pre></div></p><p><h3>Paquete TCP vacío y lo manda al puerto 80 para verificar la actividad</h3></p><p></p><p><div class="codebox"><pre><br /><span style="color:#000000;font-weight:700">sudo</span> nmap -PS -n -sn 192.168.20.0<span style="color:#000000;font-weight:700">/</span>24</pre></div></p><p><h3>Escanea los host activos pero no se puede spoofear porque verifica con un paquete TCP vacío al puerto 80 y si no responde no está activo.</h3></p><p><h3>Aunque el puerto esté cerrado el host responde con un reset por lo que la maquina sigue estando activa</h3></p><p></p><p><div class="codebox"><pre>-PU &lt;port list&gt; <span style="color:#000000;font-weight:700">(</span>UDP Ping<span style="color:#000000;font-weight:700">)</span> <br /><br /><span style="color:#000000;font-weight:700">sudo</span> nmap -PU -n -sn 192.168.20.0<span style="color:#000000;font-weight:700">/</span>24</pre></div></p><p></p><p><h3>Comandos de escaneo de puertos:</h3></p><p><div class="codebox"><pre> -sS <span style="color:#000000;font-weight:700">(</span>TCP SYN scan<span style="color:#000000;font-weight:700">)</span> <br /> -sU <span style="color:#000000;font-weight:700">(</span>UDP scans<span style="color:#000000;font-weight:700">)</span> <br /> -sA <span style="color:#000000;font-weight:700">(</span>TCP ACK scan<span style="color:#000000;font-weight:700">)</span> </pre></div></p><p><h3>Solo son algunos ejemplos, para mas:  </h3><h3>https://nmap.org/book/man-port-scanning-techniques.html</h3></p><p></p><p>------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</p><p></p><p><h3>Script para spoofear una mac address con python y engañar a un escaneo sin verificación de actividad en algún puerto de la maquina objetvo </h3></p><p></p><p><div class="codebox"><pre><span style="color:#ad7fa8;font-weight:400">from</span> <span style="color:#729fcf;font-weight:400">scapy.all</span> <span style="color:#ad7fa8;font-weight:400">import</span> *<br /><br /><span style="color:#000000;font-weight:700">def</span> <span style="color:#729fcf;font-weight:400">handle_packet</span>(packet):<br />    <span style="color:#000000;font-weight:700">if</span> packet[ARP].op == <span style="color:#edd400;font-weight:400">1</span>:<br />        <span style="color:#000000;font-weight:700">if</span> packet.pdst == <span style="color:#edd400;font-weight:400">&quot;192.168.20.152&quot;</span>:<br />            <span style="color:#729fcf;font-weight:400">print</span>(<span style="color:#edd400;font-weight:400">&quot;Sending ARP response&quot;</span>)<br />            reply = ARP(op=<span style="color:#edd400;font-weight:400">2</span>,<br />                        hwsrc=<span style="color:#edd400;font-weight:400">&quot;00:0C:29:3D:1D:6F&quot;</span>,<br />                        psrc=<span style="color:#edd400;font-weight:400">&quot;192.168.20.152&quot;</span>,<br />                        hwdst=<span style="color:#edd400;font-weight:400">&quot;00:50:56:C0:00:03&quot;</span>,<br />                        pdst=<span style="color:#edd400;font-weight:400">&quot;192.168.20.255&quot;</span>)<br />            pkt = Ether(dst=<span style="color:#edd400;font-weight:400">&quot;00:50:56:C0:00:03&quot;</span>, src=<span style="color:#edd400;font-weight:400">&quot;00:0C:29:3D:1D:6F&quot;</span>) / reply<br />            sendp(pkt)<br />                        <br /><br />sniff(<span style="color:#729fcf;font-weight:400">filter</span>=<span style="color:#edd400;font-weight:400">&quot;arp&quot;</span>, prn=handle_packet)</pre></div></p><p></p><p>------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</p><p></p><p><strong><h1>--EJEMPLO REAL--</h1></strong></p><p></p><p><h3>Con los nodos de la red o host ahora identificar los puertos que tienen abiertos en la red sin ser detectados por SNORT.</h3></p><p></p><p><div class="codebox"><pre><br /><span style="color:#000000;font-weight:700">sudo</span> nmap -PS -n -sn 192.168.20.0<span style="color:#000000;font-weight:700">/</span>24</pre></div></p><p><h3>Escaneo de nodos/hosts</h3></p><p></p><p><h3>Y si ahora realizásemos un escaneo de puertos con cualquiera de las técnicas proporcionadas por nmap como -sS/-sU/-sA....</h3></p><p><h3>inmediatamente seríamos detectados por SNORT y si estuviera configurado como tal nos habría podido sacar rápidamente de la subred para aislarnos y así evitar intrusiones.</h3></p><p></p><p></p><p><h3>Para poder evitar tanto trafico a la hora de escanear los puertos podemos usar técnicas de especificación de paquetes.</h3></p><p></p><p><div class="codebox"><pre><br />--top-ports 5</pre></div></p><p><h3>Analiza los &lt;n&gt; puertos con la mayor proporción encontrados en el archivo nmap-services después de excluir todos los puertos especificados por --exclude-ports. &lt;n&gt; debe ser 1 o superior</h3></p><p></p><p><div class="codebox"><pre><br /><span style="color:#000000;font-weight:700">sudo</span> nmap -sS -n --top-ports 5 192.168.20.128</pre></div></p><p><h3>Con este escaneo es menos probable ser detectados porque se genera mucho menos ruido </h3></p><p><img src="images/3-2.png" alt="images/3-2.png" /></p><p></p><p><h3>Como se puede ver en este escaneo de wireshark el tráfico generado es mucho menor que un escaneo completo y SNORT u otros IDS no lo detectarán como actividad sospechosa</h3></p><p></p><p></p><p><h3>Es muy importante controlar el numero de puertos en números bajos ya que a mayor numero el tráfico puede ser suficiente como para alertar al IDS, mejor no ser avariciosos y tener paciencia.</h3></p><p></p><p></p><p><div class="codebox"><pre><br />-p10,11,15,32 </pre></div></p><p><h3>Es importante saber que puedes escanear puertos manualmente con en anterior comando especificando de forma manual.</h3></p><p><h3>Vamos a utilizar otras técnicas para modificar los paquetes y así evadir otras posibles medidas de seguridad.</h3></p><p></p><p>------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</p><p></p><p><strong><h1>FRAGMENTACIÓN DE PAQUETES </h1></strong></p><p></p><p><h3>https://nmap.org/book/man-bypass-firewalls-ids.html</h3></p><p></p><p></p><p><div class="codebox"><pre><br /> -f <span style="color:#000000;font-weight:700">(</span>fragment packets<span style="color:#000000;font-weight:700">);</span> --mtu <span style="color:#000000;font-weight:700">(</span>using the specified MTU<span style="color:#000000;font-weight:700">)</span> </pre></div></p><p></p><p><h3>Coge los paquetes que utilizará para el escaneo y los divide en fragmentos más pequeños o IP packets.</h3></p><p><h3>La idea es dividir la cabecera del paquete TCP de 20bytes, en bloques menores y enviarlos. </h3><h3></h3></p><p><h3>Su objetivo es principalmente evitar FIREWALLS herramientas que analizan la cabecera del paquete y la rechazan en función de ciertos parámetros.</h3></p><p></p><p><h3>Actualmente esta medida es muy popular pero funciona pocas veces ya que es muy fácil ser detectada.</h3></p><p></p><p><h2>Esta es la diferencia de realizar un escaneo con o sin fragmentación respectivamente.</h2></p><p></p><p>  <div class="codebox"><pre><br />nmap -sS -n -p10 </pre></div></p><p> <img src="images/3-3.png" alt="images/3-3.png" /></p><p></p><p></p><p><h3>Como se observa genera el tráfico TCP con SYN ACK en un paquete completo, pero si un firewall estuviese bloqueando la conexiones de protocolo TCP podemos:</h3></p><p></p><p><div class="codebox"><pre><br />nmap -sS -n -p10 -f</pre></div></p><p></p><p><img src="images/3-4.png" alt="images/3-4.png" /></p><p></p><p><h3>Sin embargo si observamos SNORT vemos un aviso peculiar</h3></p><p></p><p><img src="images/3-5.png" alt="images/3-5.png" /></p><p></p><p><h3>Detecta que se han enviado pequeños fragmentos de paquetes IP que luego se deben re-ensamblar en la maquina objetivo y esto provoca el aviso debido a que esta es una de las formás mas comunes de hacer ataques DDoS o denegación de servicio</h3></p><p><h3>ya que se satura al servidor con pequeños paquetes de forma masiva que debe reformar en paquetes TCP y devolver, provocando ralentización o colapso de los servicios.</h3></p><p></p><p></p><p><h3>Lo que podemos hacer es fragmentar aun más los paquetes de 8 a 16 bytes añadiendo un f más al comando anterior</h3></p><p></p><p><div class="codebox"><pre><br />nmap -sS -n -p10 -ff</pre></div></p><p><img src="images/3-6.png" alt="images/3-6.png" /></p><p></p><p><h3>De esta forma SNORT no detecta los paquetes y vemos como en vez de 3 paquetes fragmentados solo hay dos ya que una cabecera de 20 bytes dividida en paquetes de 16 son 2 y dividida en paquetes de 8 son 3.</h3></p><p></p><p><div class="codebox"><pre><br />nmap -sS -n -mtu &lt;8bytes o multiplos de 8&gt;</pre></div></p><p><h3>Con el anterior comando podemos especificar el número de bytes en el que fragmentar los paquetes.</h3></p><p></p><p><h3>En resumen esta técnica es útil para evadir ciertas medidas de seguridad como firewalls pero hay que tener en cuenta no masificar el tráfico por muy fragmentado que esté, si no los IDS detectarán rápido un escaneo de puertos.</h3></p><p></p><p></p><p>------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</p><p></p><p></p><p><h1>Decoy scan o escaneo de señuelo</h1></p><p></p><p></p><p><div class="codebox"><pre><br /> -D &lt;decoy1&gt;[,&lt;decoy2&gt;][,ME][,...] <span style="color:#000000;font-weight:700">(</span>Cloak a scan with decoys<span style="color:#000000;font-weight:700">)</span> </pre></div></p><p></p><p><h3>Provoca un “spoofing” en la dirección IP  de origen que realiza el escaneo (máquina atacante), con el objetivo de que cuando tengamos un HOST dentro de la red al que queramos escanear, las máquinas de IDS o defensa de la red no detecten que el escaneo se está llevando a cabo desde nuestra maquina, utilizamos NMAP para modificar la IP de origen de los paquetes que lancemos para el escaneo. </h3></p><p><h3>De esta manera si tenemos un IDS, este detectará que hay varias máquinas dentro de su subred que intentan escanear el objetivo y no sabrá identificar correctamente cual es la máquina atacante.</h3></p><p></p><p><div class="codebox"><pre><br />nmap -sS -n -D 192.168.20.1,192.169.20.254,ME 192.168.20.128</pre></div></p><p><h3>Con esta opción le indicamos una serie de direcciones IP que use como señuelo, aunque si queremos que sea realista debemos usar las mismas que se obtienen con el escaneo de NODOS o HOST realizados previamente y que se encuentran activas dentro de la subred.</h3></p><p></p><p><h3>En este caso usamos algunas básicas y ME para que indicar que añada nuestra IP al “spoofing”</h3>.</p><p></p><p><img src="images/3-7.png" alt="images/3-7.png" /></p><p></p><p><h3>Como se observa en SNORT detecta el escaneo de puertos desde varias IP, siendo las mismas que le hemos indicado previamente. </h3></p><p></p><p><h3>Esto es más un método preventivo para el posible análisis posterior del ataque.</h3></p><p></p><p><h3>Una cosa a tener en cuenta es que si indicamos dentro de las IP señuelo la misma IP que la maquina objetivo obtendremos un gran número de alertas en SNORT ya que es raro que una IP se escanee a si misma y es muy sospechoso</h3>.</p><p></p><p></p><p></p><p>------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</p><p></p><p><strong><h1>Parámetro -S</h1></strong></p><p></p><p><h3>Permite que manipulemos la dirección IP de origen desde la que se realiza el escaneo desde NMAP. Es muy parecido al método anterior pero no usamos señuelos, simplemente modificamos la IP desde la que se generan los paquetes de escaneo.</h3></p><p></p><p><div class="codebox"><pre><br />nmap -n -S 192.168.20.1 192.168.20.128</pre></div></p><p><h3>Igual que antes lo recomendable es usar maquinas que estén activas dentro de la subred en la que estemos ya que así parecerá una petición normal de servicios o un simple error de algún servicio en segundo plano, etc</h3></p><p></p><p><h3>En la ejecución de esta técnica tenemos que especificar la interfaz desde la que se enviarán los paquetes y ademas usar el parámetro -Pn que,  se utiliza para indicar a la herramienta que no realice el descubrimiento de hosts (ping host) antes de escanear los puertos. Básicamente, desactiva la función de detección de hosts y asume que los objetivos especificados están activos.</h3></p><p></p><p><h3>El motivo por el cual nos pida la interfaz de escaneo es porque cuando dos nodos o HOST dentro de una misma subred se intentan comunicar lo hacen mediante su dirección física o MAC ya que la dirección IP se utiliza para la comunicación entre NODOS de diferentes redes y por eso existe el protocolo ARP. Y es debido a esto que a la hora de realizar el port scan con NMAP indicando la IP, este primero realiza un ARP request para preguntar cuál es la dirección física de la IP para poder enviar los paquetes</h3>.</p><p></p><p><h3>De esta forma con esta técnica buscamos modificar la IP de origen pero no la dirección MAC ya que si lo hiciésemos mandaríamos la información pero no podríamos tenerla de vuelta ya que la MAC no se corresponde.</h3></p><p></p><p><div class="codebox"><pre><br />nmap -n -Pn -S 192.168.20.1 -e eth0 192.168.20.128</pre></div></p><p></p><p><h3>En la versión de NMAP 7.94 o 7.92 no es posible así que nos iremos a una inferior</h3>.</p><p></p><p><h3>http://ftp.de.debian.org/debian/pool/main/n/nmap/nmap_7.91+dfsg1+really7.80+dfsg1-2_amd64.deb</h3></p><p></p><p>Si es necesario debido a un error de libreria lua-lpeg o similares descargar e instalar igualmente</p><p></p><p><h3>https://packages.debian.org/bookworm/lua-lpeg</h3></p><p><h3>https://packages.debian.org/bullseye/libssl1.1</h3></p><p></p><p><h3>Hecho el escaneo vemos como en SNORT indica que el escaneo hacia 192.168.20.198 es proveniente de la dirección 192.168.20.1 que es la manipulada ya que la real es 192.168.20.129</h3></p><p></p><p><img src="images/3-8.png" alt="images/3-8.png" /></p><p></p><p><img src="images/3-9.png" alt="images/3-9.png" /></p><p></p><p><h3>Si vemos en WireShark también indica que la IP que se quiere comunicar con la objetivo es la 192.168.20.1 y no la real</h3>.</p><p></p><p></p><p><h3>Esta técnica también es muy útil cuando hay configurado un firewall que solo permite o limita la conexión de acceso por dirección IP de origen, por lo que manipulando nuestra IP de esta forma podremos saltarnos esa barrera de acceso.</h3></p><p></p><p><h3>Además a veces el firewall puede estar configurado para que además de una dirección IP concreta también sea mediante un puerto concreto por lo que tendremos que especificar el puerto desde el que realizar el escaneo</h3>.</p><p></p><p></p><p><div class="codebox"><pre><br />nmap -n -Pn -S 192.168.20.1 --source-port 80 -p21 -e eth0 192.168.20.128</pre></div></p><p><img src="images/3-10.png" alt="images/3-10.png" /></p><p></p><p><h3>Como vemos el escaneo indica que se realiza desde el puerto 80 al 21</h3></p><p></p><p></p><p>------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</p><p></p><p></p><p><h1>Control de tiempos en un escaneo</h1></p><p></p><p><h3>Una de las técnicas por excelencia en un escaneo para evadir herramientas de seguridad como IDS o IPS.</h3></p><p></p><p><h3>Esto es importante porque estas soluciones de seguridad implementan reglas que se basan en la combinación de diferentes reglas como por ejemplo:</h3></p><p></p><p><h3>Si se detecta más de X numero de paquetes TCP que van dirigidos a diferentes puertos es posible que sea un escaneo. Además se suele combinar con otra regla que indica que si además si este envío de paquetes se realiza en menos de X tiempo es más probable que sea una alerta de escano. </h3></p><p></p><p><h3>https://nmap.org/book/man-performance.html</h3></p><p></p><p><div class="codebox"><pre><br /> -T paranoid<span style="color:#000000;font-weight:700">|</span>sneaky<span style="color:#000000;font-weight:700">|</span>polite<span style="color:#000000;font-weight:700">|</span>normal<span style="color:#000000;font-weight:700">|</span>aggressive<span style="color:#000000;font-weight:700">|</span>insane <span style="color:#000000;font-weight:700">(</span>Set a timing template<span style="color:#000000;font-weight:700">)</span> <br /> paranoid <span style="color:#000000;font-weight:700">(</span>0<span style="color:#000000;font-weight:700">)</span>, sneaky <span style="color:#000000;font-weight:700">(</span>1<span style="color:#000000;font-weight:700">)</span>, polite <span style="color:#000000;font-weight:700">(</span>2<span style="color:#000000;font-weight:700">)</span>, normal <span style="color:#000000;font-weight:700">(</span>3<span style="color:#000000;font-weight:700">)</span>, aggressive <span style="color:#000000;font-weight:700">(</span>4<span style="color:#000000;font-weight:700">)</span>, and insane <span style="color:#000000;font-weight:700">(</span>5<span style="color:#000000;font-weight:700">)</span></pre></div></p><p><div class="codebox"><pre><br /> --scan-delay &lt;time&gt;<span style="color:#000000;font-weight:700">;</span> --max-scan-delay &lt;time&gt; <span style="color:#000000;font-weight:700">(</span>Adjust delay between probes<span style="color:#000000;font-weight:700">)</span> <br /> </pre></div></p><p><h3>Indicando mediante numero INT  cuantos segundos debe esperar entre cada paquete</h3>.</p><p></p><p><h3>Hoy en dia aunque realicemos el escaneo con -T 0 que sería el mas tardado SNORT u otros IDS lo detectará.</h3></p><p></p><p><h3>Para optimizar esto haremos un pequeño BASH script:</h3></p><p><div class="codebox"><pre><br /><span style="color:#000000;font-weight:700">for</span> <span style="color:#8ae234;font-weight:700">i</span> <span style="color:#000000;font-weight:700">in</span> <span style="color:#000000;font-weight:700">{</span>0..30..2<span style="color:#000000;font-weight:700">};</span> <span style="color:#000000;font-weight:700">do;</span> <span style="color:#000000;font-weight:700">sudo</span> nmap -sS -p$<span style="color:#000000;font-weight:700">((</span><span style="color:#8ae234;font-weight:700">$i</span>+1<span style="color:#000000;font-weight:700">))</span>-$<span style="color:#000000;font-weight:700">((</span>i+2<span style="color:#000000;font-weight:700">))</span> -n 192.168.20.128<span style="color:#000000;font-weight:700">;</span> <span style="color:#000000;font-weight:700">sleep</span> 40<span style="color:#000000;font-weight:700">;</span> <span style="color:#000000;font-weight:700">done;</span> </pre></div></p><p></p><p><h3>Lo que va a realizar es un recorrido de 0 a 30 de 2 en 2 puertos lanzando NMAP para esos dos puertos concretos, espera 30 segundos y continua.</h3></p><p><h3>Aunque esperemos, si aumentamos el numero de puertos que escanea es más probable que nos detecte</h3>.</p><p></p><p></p><p>------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</p><p></p><p></p><p><h1>Utilizar protocolo IPV6 </h1></p><p></p><p><h3>Las direcciones IP tienen un número finito de nodos que pueden referenciar definido por 32bytes, lo que hace que con tanta cantidad de dispositivos ya no se pueda referenciar a todos con una dirección IP por lo que surgió IPV6 y al igual que IPV4 referencias los HOST de la subred pero con más bytes</h3>.</p><p></p><p><h3>Esto importante porque actualmente IPV6 es muy soportado para la intercomunicación pero las reglas en los sistemas de seguridad como IDS no están tan orientadas a tráfico IPV6 por lo que puede ser una puerta de entrada para evadir esta seguridad</h3>.</p><p></p><p></p><p><h3>Para poder referenciar el objetivo con su IPV6 usaremos el concepto DIRECCIONES MULTICAST</h3>,</p><p><h3> (dirección de multi difusión) es una dirección IP especial que se utiliza para enviar datos desde un único emisor a varios receptores en una red. A diferencia de las direcciones unicast (para una sola interfaz de red) y las direcciones de difusión (para todas las interfaces en una red), las direcciones multicast se utilizan para comunicarse con un grupo específico de hosts en la red.</h3></p><p> </p><p><h3> De manera lógica se referencia un número de nodos en una red con el objetivo de poder enviar información sin necesidad de establecer comunicaciones individuales con cada uno de ellos.</h3></p><p> </p><p><h3> Las direcciones multicast se encuentran dentro del rango reservado de direcciones IP asignado para este propósito. El rango IPv4 asignado para direcciones multicast es 224.0.0.0 a 239.255.255.255.</h3></p><p><h3> En IPv6, las direcciones multicast se representan con el prefijo </h3><code><h3>ff00::/8</h3></code><h3>. Estas direcciones son esenciales para funciones como la autoconfiguración sin estado, la transmisión de mensajes de enrutamiento y otros servicios específicos de IPv6.</h3></p><p> </p><p> <img src="images/3-11.png" alt="images/3-11.png" /></p><p> </p><p><h3> Entonces para descubrir los nodos o vecinos de la subred con IPV6 vamos a utilizar PING6 que enviará paquetes ICMP a todos los nodos de la red</h3>.</p><p> </p><p><div class="codebox"><pre><br />ping6 ff02<span style="color:#000000;font-weight:700">::</span>1 </pre></div></p><p><div class="codebox"><pre><br />ip neigh</pre></div></p><p><h3>Para ver los “vecinos&quot; que nos han respondido</h3></p><p><img src="images/3-12.png" alt="images/3-12.png" /></p><p></p><p><div class="codebox"><pre><br /><span style="color:#000000;font-weight:700">sudo</span> nmap -sS -n -6 fe80<span style="color:#000000;font-weight:700">::</span>20c<span style="color:#000000;font-weight:700">:</span>29ff<span style="color:#000000;font-weight:700">:</span>fe21<span style="color:#000000;font-weight:700">:</span>7bf1 -e eth0</pre></div></p><p></p><p><h3>Esto puede no detectar algunos puertos con servicios que no soporten comunicación IPV6 pero también evitará que firewalls sin configuración para IPV6 tampoco nos detecten, aunque en este caso SNORT si que detecta el escaneo de puertos.</h3></p><p></p><p></p><p>------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</p><p></p><p><h1>ESCANEO DE SERVICIOS </h1></p><p></p><p><h3>Una vez sabemos que máquinas están levantadas y que puertos están abiertos nos interesa saber que servicios están ejecutándose en ellos y que versiones tienen</h3>.</p><p></p><p><div class="codebox"><pre><br /><span style="color:#000000;font-weight:700">sudo</span> nmap -sV </pre></div></p><p></p><p><h3>Para no tener que realizar un escaneo de servicios a todos los puertos sino que con la previa información obtenida lo direccionamos directamente a los puertos de interés.</h3></p><p></p><p><div class="codebox"><pre><br /><span style="color:#000000;font-weight:700">sudo</span> nmap -sV -n -p21,22,80 192.168.20.128</pre></div></p><p></p><p><h3>Al ser tan dirigido no saltaran alarmas en el IDS</h3>.</p><p><h3>Es muy importante tener en conocimiento los puertos y los host activos para evitar rudio innecesario a la hora de reconocer servicios o aplicaciones activas en una maquina</h3>.</p><p></p><p><h3>De igual forma para identificar el sistema operativo de la maquina</h3></p><p><div class="codebox"><pre><br /><span style="color:#000000;font-weight:700">sudo</span> nmap -O -n 192.168.20.128</pre></div></p><p></p><p><h3>Y por defecto NMAP realizará un escaneo de puertos de forma automática para recabar información sobre los mismos y así obtener que sistema los ejecuta, por lo que hará ruido innecesario y activara los IDS</h3>.</p><p></p><p><div class="codebox"><pre><br /><span style="color:#000000;font-weight:700">sudo</span> nmap -O -n -p21,22,80 192.168.20.128</pre></div></p><p><h3>Aun así es arriesgado y es posible ser detectados pero añadiendo todas las técnicas anteriores para combinar reduciremos el ruido y las posibilidades de ser detectados.</h3></p><p></p><p></p><p></p><p></p><p></p><p><h1>Uso de scripts:</h1></p><p></p><p><a href="https://securitytrails.com/blog/nmap-vulnerability-scan">https://securitytrails.com/blog/nmap-vulnerability-scan</a></p><p></p><p><div class="codebox"><pre><br /><span style="color:#000000;font-weight:700">sudo</span> nmap --script <span style="color:#edd400;font-weight:400">&quot;vuln&quot;</span> -p80 192.168.20.xx</pre></div></p><p></p><p><h3>Vulnscan:</h3></p><p></p><p><div class="codebox"><pre><br />git clone https<span style="color:#000000;font-weight:700">://</span>github.com<span style="color:#000000;font-weight:700">/</span>scipag<span style="color:#000000;font-weight:700">/</span>vulscan scipag_vulscan<br /><span style="color:#000000;font-weight:700">ln</span> -s <span style="color:#ad7fa8;font-weight:400">`pwd`</span><span style="color:#000000;font-weight:700">/</span>scipag_vulscan <span style="color:#000000;font-weight:700">/</span>usr<span style="color:#000000;font-weight:700">/</span>share<span style="color:#000000;font-weight:700">/</span>nmap<span style="color:#000000;font-weight:700">/</span>scripts<span style="color:#000000;font-weight:700">/</span>vulscan<br />nmap -sV --script=vulscan<span style="color:#000000;font-weight:700">/</span>vulscan.nse www.example.com<br /></pre></div></p><p></p><p><h3>Vulners</h3>:</p><p></p><p><div class="codebox"><pre><br /><span style="color:#000000;font-weight:700">cd</span> <span style="color:#000000;font-weight:700">/</span>usr<span style="color:#000000;font-weight:700">/</span>share<span style="color:#000000;font-weight:700">/</span>nmap<span style="color:#000000;font-weight:700">/</span>scripts<span style="color:#000000;font-weight:700">/</span><br />git clone https<span style="color:#000000;font-weight:700">://</span>github.com<span style="color:#000000;font-weight:700">/</span>vulnersCom<span style="color:#000000;font-weight:700">/</span>nmap-vulners.git<br />nmap --script nmap-vulners<span style="color:#000000;font-weight:700">/</span> -sV 11.22.33.44<br /></pre></div></p><p></p><p><img src="images/3-13.png" alt="images/3-13.png" /></p></div>
</body>
</html>
